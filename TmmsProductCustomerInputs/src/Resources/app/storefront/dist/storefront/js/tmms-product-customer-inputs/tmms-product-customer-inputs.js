(()=>{"use strict";class t{static iterate(t,e){if(t instanceof Map||Array.isArray(t))return t.forEach(e);if(t instanceof FormData){for(var r of t.entries())e(r[1],r[0]);return}if(t instanceof NodeList)return t.forEach(e);if(t instanceof HTMLCollection)return Array.from(t).forEach(e);if(t instanceof Object)return Object.keys(t).forEach(r=>{e(t[r],r)});throw Error("The element type ".concat(typeof t," is not iterable!"))}}class e{static serialize(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if("FORM"!==t.nodeName){if(e)throw Error("The passed element is not a form!");return{}}return new FormData(t)}static serializeJson(r){let s=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=e.serialize(r,s);if(0===Object.keys(i).length)return{};let n={};return t.iterate(i,(t,e)=>n[e]=t),n}}class r{get(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/json",s=this._createPreparedRequest("GET",t,r);return this._sendRequest(s,null,e)}post(t,e,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";s=this._getContentType(e,s);let i=this._createPreparedRequest("POST",t,s);return this._sendRequest(i,e,r)}delete(t,e,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";s=this._getContentType(e,s);let i=this._createPreparedRequest("DELETE",t,s);return this._sendRequest(i,e,r)}patch(t,e,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";s=this._getContentType(e,s);let i=this._createPreparedRequest("PATCH",t,s);return this._sendRequest(i,e,r)}abort(){if(this._request)return this._request.abort()}setErrorHandlingInternal(t){this._errorHandlingInternal=t}_registerOnLoaded(t,e){e&&(!0===this._errorHandlingInternal?(t.addEventListener("load",()=>{e(t.responseText,t)}),t.addEventListener("abort",()=>{console.warn("the request to ".concat(t.responseURL," was aborted"))}),t.addEventListener("error",()=>{console.warn("the request to ".concat(t.responseURL," failed with status ").concat(t.status))}),t.addEventListener("timeout",()=>{console.warn("the request to ".concat(t.responseURL," timed out"))})):t.addEventListener("loadend",()=>{e(t.responseText,t)}))}_sendRequest(t,e,r){return this._registerOnLoaded(t,r),t.send(e),t}_getContentType(t,e){return t instanceof FormData&&(e=!1),e}_createPreparedRequest(t,e,r){return this._request=new XMLHttpRequest,this._request.open(t,e),this._request.setRequestHeader("X-Requested-With","XMLHttpRequest"),r&&this._request.setRequestHeader("Content-type",r),this._request}constructor(){this._request=null,this._errorHandlingInternal=!1}}function s(t,e,r){t.addEventListener?t.addEventListener(e,r,!1):t.attachEvent&&t.attachEvent("on"+e,r)}class i extends window.PluginBaseClass{init(){this.$emitter.publish("beforeInitSaveCustomerInput"),s(this.el,"change",function(){this.client=new r,"number"!==this.getAttribute("type")||this.hasAttribute("required")||this.removeAttribute("form");let t=this.closest("form"),s=!0,i=!1;!this.hasAttribute("required")||(i=!0,"checkbox"===this.getAttribute("type")?this.checked?this.removeAttribute("form"):this.hasAttribute("form")||this.setAttribute("form",this.getAttribute("data-form")):""!==this.value?this.removeAttribute("form"):this.hasAttribute("form")||this.setAttribute("form",this.getAttribute("data-form"))),this.classList.contains("tmms-customer-input-is-required")&&("checkbox"===this.getAttribute("type")?this.checked?(this.classList.remove("tmms-customer-input-is-empty"),t.classList.remove("tmms-customer-input-form-input-is-empty")):(this.classList.add("tmms-customer-input-is-empty"),t.classList.add("tmms-customer-input-form-input-is-empty"),this.classList.contains("tmms-customer-input-do-not-save-empty-required-field")&&(s=!1)):""!==this.value?(this.classList.remove("tmms-customer-input-is-empty"),t.classList.remove("tmms-customer-input-form-input-is-empty")):(this.classList.add("tmms-customer-input-is-empty"),t.classList.add("tmms-customer-input-form-input-is-empty"),this.classList.contains("tmms-customer-input-do-not-save-empty-required-field")&&(s=!1)));let n=this.closest("form"),o=this.getAttribute("data-path"),a=e.serialize(n);if("number"===this.getAttribute("type")){let t=this.value,e=this.getAttribute("min"),r=this.getAttribute("max"),n=this.getAttribute("step"),o=0,a=0,u=0,l=0,d=!1,c=0,h=0,m=0;n&&(d=!0),!0===d?-1!==n.indexOf(".")?(m=Math.pow(10,h=n.substring(n.indexOf(".")+1).length),o=parseFloat(t)*m,a=parseFloat(e)*m,u=parseFloat(r)*m,l=n*m):(c=1,l=parseInt(n,10)):c=1,1===c&&(o=parseInt(t,10),a=parseInt(e,10),u=parseInt(r,10)),o>=a&&o<=u?!0===d&&((o-a).toFixed(h)%l!=0&&0==c||(o-a)%l!=0&&1==c)&&(s=!1):(s=!1,o>u?this.hasAttribute("form")||this.setAttribute("form",this.getAttribute("data-form")):o<a&&!this.hasAttribute("form")&&this.setAttribute("form",this.getAttribute("data-form"))),i?""===t&&(s=!1):""===t&&(s=!0)}s&&(this.$emitter.publish("beforeSaveCustomerInputSendPostRequest",a),this.client.post(o.toLowerCase(),a,t=>{this.$emitter.publish("afterSaveCustomerInputSendPostRequest")}))}),s(this.el,"keydown",t=>{let e=this.el;if(("text"===e.getAttribute("type")||"number"===e.getAttribute("type"))&&e.classList.contains("block-enter-key")&&(13===t.which||13===t.keyCode))return t.preventDefault(),!1})}}class n{static ucFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}static lcFirst(t){return t.charAt(0).toLowerCase()+t.slice(1)}static toDashCase(t){return t.replace(/([A-Z])/g,"-$1").replace(/^-/,"").toLowerCase()}static toLowerCamelCase(t,e){let r=n.toUpperCamelCase(t,e);return n.lcFirst(r)}static toUpperCamelCase(t,e){return e?t.split(e).map(t=>n.ucFirst(t.toLowerCase())).join(""):n.ucFirst(t.toLowerCase())}static parsePrimitive(t){try{return/^\d+(.|,)\d+$/.test(t)&&(t=t.replace(",",".")),JSON.parse(t)}catch(e){return t.toString()}}}class o{static isNode(t){return"object"==typeof t&&null!==t&&(t===document||t===window||t instanceof Node)}static hasAttribute(t,e){if(!o.isNode(t))throw Error("The element must be a valid HTML Node!");return"function"==typeof t.hasAttribute&&t.hasAttribute(e)}static getAttribute(t,e){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(r&&!1===o.hasAttribute(t,e))throw Error('The required property "'.concat(e,'" does not exist!'));if("function"!=typeof t.getAttribute){if(r)throw Error("This node doesn't support the getAttribute function!");return}return t.getAttribute(e)}static getDataAttribute(t,e){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],s=e.replace(/^data(|-)/,""),i=n.toLowerCamelCase(s,"-");if(!o.isNode(t)){if(r)throw Error("The passed node is not a valid HTML Node!");return}if(void 0===t.dataset){if(r)throw Error("This node doesn't support the dataset attribute!");return}let a=t.dataset[i];if(void 0===a){if(r)throw Error('The required data attribute "'.concat(e,'" does not exist on ').concat(t,"!"));return a}return n.parsePrimitive(a)}static querySelector(t,e){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(r&&!o.isNode(t))throw Error("The parent node is not a valid HTML Node!");let s=t.querySelector(e)||!1;if(r&&!1===s)throw Error('The required element "'.concat(e,'" does not exist in parent node!'));return s}static querySelectorAll(t,e){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(r&&!o.isNode(t))throw Error("The parent node is not a valid HTML Node!");let s=t.querySelectorAll(e);if(0===s.length&&(s=!1),r&&!1===s)throw Error('At least one item of "'.concat(e,'" must exist in parent node!'));return s}static getFocusableElements(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;return t.querySelectorAll('\n            input:not([tabindex^="-"]):not([disabled]):not([type="hidden"]),\n            select:not([tabindex^="-"]):not([disabled]),\n            textarea:not([tabindex^="-"]):not([disabled]),\n            button:not([tabindex^="-"]):not([disabled]),\n            a[href]:not([tabindex^="-"]):not([disabled]),\n            [tabindex]:not([tabindex^="-"]):not([disabled])\n        ')}static getFirstFocusableElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;return this.getFocusableElements(t)[0]}static getLastFocusableElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,e=this.getFocusableElements(t);return e[e.length-1]}}class a extends window.PluginBaseClass{init(){this.$emitter.publish("beforeInitRepeatOrderSaveCustomerInput");let t=window.PluginManager.getPluginInstances("AddToCart");t&&t.forEach(t=>{t.$emitter.subscribe("beforeFormSubmit",t=>{this.client=new r;let s=t.target.getAttribute("id");if(s){let t=s.replace("orderDetailForm-",""),r=o.querySelectorAll(document,".order-item-tmms-customer-input-form[data-orderId='"+t+"']",!1);r.length>0&&r.forEach(t=>{let r=t.getAttribute("action"),s=e.serialize(t);this.$emitter.publish("beforeRepeatOrderSaveCustomerInputSendPostRequest",s),this.client.post(r.toLowerCase(),s,t=>{this.$emitter.publish("afterRepeatOrderSaveCustomerInputSendPostRequest")})})}})})}}let u=window.PluginManager;u.register("SaveCustomerInputPlugin",i,'[data-save-customer-input="true"]'),u.register("RepeatOrderSaveCustomerInputPlugin",a)})();